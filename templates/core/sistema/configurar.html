{% extends 'base.html' %}

{% block title %}Configuración del Sistema - Sistema de Construcción{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
        <i class="fas fa-cog me-2"></i>Configuración del Sistema
    </h2>
    <a href="{% url 'sistema' %}" class="btn btn-outline-primary">
        <i class="fas fa-arrow-left me-2"></i>Volver al Sistema
    </a>
</div>

<div class="row">
    <div class="col-lg-8 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-sliders-h me-2"></i>Configuración General
                </h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Información de la Empresa -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-building me-2"></i>Información de la Empresa
                            </h6>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="nombre_empresa" class="form-label">
                                <i class="fas fa-building me-1"></i>Nombre de la Empresa
                            </label>
                            <input type="text" class="form-control" id="nombre_empresa" name="nombre_empresa" 
                                   value="{{ config.nombre_empresa|default:'Constructora XYZ' }}">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="moneda" class="form-label">
                                <i class="fas fa-dollar-sign me-1"></i>Moneda Principal
                            </label>
                            <select class="form-select" id="moneda" name="moneda">
                                <option value="GTQ" {% if config.moneda == 'GTQ' %}selected{% endif %}>Quetzal (GTQ)</option>
                                <option value="USD" {% if config.moneda == 'USD' %}selected{% endif %}>Dólar (USD)</option>
                                <option value="EUR" {% if config.moneda == 'EUR' %}selected{% endif %}>Euro (EUR)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Configuración Regional -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-globe me-2"></i>Configuración Regional
                            </h6>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="zona_horaria" class="form-label">
                                <i class="fas fa-clock me-1"></i>Zona Horaria
                            </label>
                            <select class="form-select" id="zona_horaria" name="zona_horaria">
                                <option value="America/Guatemala" {% if config.zona_horaria == 'America/Guatemala' %}selected{% endif %}>Guatemala (GMT-6)</option>
                                <option value="America/New_York" {% if config.zona_horaria == 'America/New_York' %}selected{% endif %}>Nueva York (GMT-5)</option>
                                <option value="Europe/Madrid" {% if config.zona_horaria == 'Europe/Madrid' %}selected{% endif %}>Madrid (GMT+1)</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="idioma" class="form-label">
                                <i class="fas fa-language me-1"></i>Idioma
                            </label>
                            <select class="form-select" id="idioma" name="idioma">
                                <option value="es" {% if config.idioma == 'es' %}selected{% endif %}>Español</option>
                                <option value="en" {% if config.idioma == 'en' %}selected{% endif %}>English</option>
                            </select>
                        </div>
                    </div>

                    <!-- Configuración del Sistema -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-server me-2"></i>Configuración del Sistema
                            </h6>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="max_usuarios_simultaneos" class="form-label">
                                <i class="fas fa-users me-1"></i>Máximo Usuarios Simultáneos
                            </label>
                            <input type="number" class="form-control" id="max_usuarios_simultaneos" 
                                   name="max_usuarios_simultaneos" value="{{ config.max_usuarios_simultaneos|default:5 }}" 
                                   min="1" max="100">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="tiempo_sesion" class="form-label">
                                <i class="fas fa-hourglass me-1"></i>Tiempo de Sesión (minutos)
                            </label>
                            <input type="number" class="form-control" id="tiempo_sesion" name="tiempo_sesion" 
                                   value="{{ config.tiempo_sesion|default:480 }}" min="15" max="1440">
                        </div>
                    </div>

                    <!-- Configuraciones Avanzadas -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">
                                <i class="fas fa-advanced me-2"></i>Configuraciones Avanzadas
                            </h6>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="respaldo_automatico" 
                                       name="respaldo_automatico" {% if config.respaldo_automatico %}checked{% endif %}>
                                <label class="form-check-label" for="respaldo_automatico">
                                    <i class="fas fa-robot me-1"></i>Respaldo Automático
                                </label>
                                <small class="form-text text-muted d-block">Habilitar respaldo automático diario</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="notificaciones_email" 
                                       name="notificaciones_email" {% if config.notificaciones_email %}checked{% endif %}>
                                <label class="form-check-label" for="notificaciones_email">
                                    <i class="fas fa-envelope me-1"></i>Notificaciones por Email
                                </label>
                                <small class="form-text text-muted d-block">Enviar notificaciones por email</small>
                            </div>
                        </div>
                    </div>

                    <!-- Botones de acción -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-outline-secondary me-md-2" onclick="restaurarValores()">
                            <i class="fas fa-undo me-1"></i>Restaurar Valores
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-1"></i>Guardar Configuración
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>Información del Sistema
                </h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-6">
                        <div class="text-center">
                            <h6 class="text-muted">Versión Django</h6>
                            <p class="h5">5.2.5</p>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <h6 class="text-muted">Python</h6>
                            <p class="h5">3.13.6</p>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="text-center mb-3">
                    <h6 class="text-muted">Estado del Sistema</h6>
                    <span class="badge bg-success fs-6">Operativo</span>
                </div>
                <hr>
                <div class="text-center">
                    <h6 class="text-muted">Última Configuración</h6>
                    <p class="text-muted">{{ config.ultima_actualizacion|default:"Nunca" }}</p>
                </div>
            </div>
        </div>

        <!-- Herramientas del Sistema -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-tools me-2"></i>Herramientas del Sistema
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <button type="button" class="btn btn-outline-primary" onclick="crearRespaldo()">
                        <i class="fas fa-download me-2"></i>Crear Respaldo
                    </button>
                    <button type="button" class="btn btn-outline-success" onclick="restaurarRespaldo()">
                        <i class="fas fa-upload me-2"></i>Restaurar Respaldo
                    </button>
                    <button type="button" class="btn btn-outline-warning" onclick="limpiarLogs()">
                        <i class="fas fa-broom me-2"></i>Limpiar Logs Antiguos
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="exportarConfiguracion()">
                        <i class="fas fa-file-export me-2"></i>Exportar Configuración
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function restaurarValores() {
    if (confirm('¿Estás seguro de que quieres restaurar los valores por defecto?')) {
        // Aquí se restaurarían los valores por defecto
        alert('Valores restaurados exitosamente');
    }
}

function crearRespaldo() {
    if (confirm('¿Estás seguro de que quieres crear un respaldo de la base de datos?')) {
        // Aquí iría la lógica para crear el respaldo
        alert('Respaldo iniciado. Se notificará cuando esté completo.');
    }
}

function restaurarRespaldo() {
    if (confirm('¿Estás seguro de que quieres restaurar un respaldo? Esto sobrescribirá la base de datos actual.')) {
        // Aquí iría la lógica para restaurar
        alert('Restauración iniciada. El sistema se reiniciará cuando esté completo.');
    }
}

function limpiarLogs() {
    if (confirm('¿Estás seguro de que quieres limpiar los logs antiguos?')) {
        // Aquí iría la lógica para limpiar logs
        alert('Limpieza de logs iniciada.');
    }
}

function exportarConfiguracion() {
    // Aquí iría la lógica para exportar
    alert('Configuración exportada exitosamente.');
}
</script>
{% endblock %}
